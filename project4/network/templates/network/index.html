{% extends "network/layout.html" %}

{% block body %}
<div id="div-allposts">
    <h2>All Posts</h2><hr>
    {% if user.is_authenticated %}
        <table class="table-allposts">
            {% if not post_to_edit %}
            <form id="new-post" method="POST">
                {% csrf_token %}
                <tr class="tr-posts" id="tr-new-post">
                    <td id="td-posts">
                        <h6 class="h2-new-post">Post here</h6>
                        <textarea id="new-post-content" name="new-post-content" rows="4" placeholder="How are you feeling today ..."></textarea><br>
                        <button type="submit" class="btn-post" id="btn-new-post" name="btn-new-post">Post</button>
                    </td>
                </tr>
            </form>
            {% endif %}
        </table>
    {% endif %}
    <table class="table-allposts" id="posts-table">
        {% for post,liked,likes in content %}
        <tr><td><br></td></tr>
        <tr class="tr-posts" id="tr-allposts">
            <td id="td-posts">
                <form id="edit-post" method="POST">{% csrf_token %}
                    {% if post_to_edit == post %}
                        <input type="hidden" name="save-edited-post-id" value="{{ post.id }}">
                        <textarea autofocus id="new-post-content" name="edit-post-content" rows="4">{{ post.content }}</textarea><br>
                        <button type="submit" class="btn-post" id="btn-save-edited-post" name="btn-save-edited-post">Save Post</button>
                    {% else %}
                        <div id="div-name-edit">
                            <input type="hidden" name="edit-post-id" value="{{ post.id }}">
                            <span><p class="p-post-name"><a href="{% url 'profile' post.posted_by_user.username %}">{{ post.posted_by_user.username }}</a></p></span>
                            {% if user.username == post.posted_by_user.username %}
                                {% if updated_post_id == post.id %}
                                    <span><button type="submit" id="btn-edit-post" name="btn-edit-post" autofocus>Edit Post</button></span>
                                {% else %}
                                    <span><button type="submit" id="btn-edit-post" name="btn-edit-post">Edit Post</button></span>
                                {% endif %}
                            {% endif %}
                        </div>
                </form>
                    <p class="p-post-content">{{ post.content }}</p>
                    <p class="p-post-time">{{ post.posted_time }}</p>
                    <div class="div-img-flex">
                        {% if user.is_authenticated %}
                            <form method="POST">{% csrf_token %}
                                <input type="hidden" name="post-id" value="{{ post.id }}">
                                {% if liked_post_id == post.id %}
                                    {% if liked %}
                                        <button type="submit" id="btn-liked" name="btn-unlike"><img class="img-like-btn" id="img-unlike" name="img-unlike" src="https://healthygirlfashion.files.wordpress.com/2016/09/poshmark-liked-button.jpg" autofocus></button>
                                    {% else %}
                                        <button type="submit" id="btn-liked" name="btn-like"><img class="img-like-btn" id="img-like" name="img-like" src="https://healthygirlfashion.files.wordpress.com/2016/09/poshmark-like-button.jpg" autofocus></button>
                                    {% endif %}
                                {% else %}
                                    {% if liked %}
                                        <button type="submit" id="btn-liked" name="btn-unlike"><img class="img-like-btn" id="img-unlike" name="img-unlike" src="https://healthygirlfashion.files.wordpress.com/2016/09/poshmark-liked-button.jpg"></button>
                                    {% else %}
                                        <button type="submit" id="btn-liked" name="btn-like"><img class="img-like-btn" id="img-like" name="img-like" src="https://healthygirlfashion.files.wordpress.com/2016/09/poshmark-like-button.jpg"></button>
                                    {% endif %}
                                {% endif %}
                            </form>
                        {% endif %}
                            <img class="img-like-btn" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ9e7kQ8rtx2XCRnZzaINKDHorF59r5ThnNJw&usqp=CAU">
                            <p id="p-total-likes">{{ likes }}</p>
                    </div>
                {% endif %}
            </td>            
        </tr>
        {% endfor %}
    </table>
</div>
{% endblock %}